<!-- Google Analytics 4 - Enhanced for Shorthand App -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DEMO123456"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  // Enhanced configuration for Shorthand app
  gtag('config', 'G-DEMO123456', {
    page_title: 'Shorthand Tutor - Professional Pitman Shorthand Learning',
    page_location: window.location.href,
    custom_map: {
      'custom_parameter_1': 'traffic_source',
      'custom_parameter_2': 'institution_type', 
      'custom_parameter_3': 'learning_module'
    },
    // Enhanced ecommerce for education
    send_page_view: true,
    cookie_expires: 63072000, // 2 years
    anonymize_ip: true
  });

  // Real-time event tracking for education platform
  function trackEducationalEvent(action, module, detail) {
    gtag('event', action, {
      event_category: 'Education',
      event_label: module,
      custom_parameter_1: getTrafficSource(),
      custom_parameter_2: 'court_reporting',
      custom_parameter_3: module,
      value: 1
    });
  }

  // Track campaign traffic sources
  function getTrafficSource() {
    const urlParams = new URLSearchParams(window.location.search);
    const source = urlParams.get('utm_source');
    if (source) return source;
    
    if (document.referrer.includes('linkedin')) return 'linkedin';
    if (document.referrer.includes('facebook')) return 'facebook';
    if (document.referrer.includes('google')) return 'google';
    return 'direct';
  }

  // Track page loads with enhanced data
  gtag('event', 'page_view', {
    page_title: document.title,
    page_location: window.location.href,
    custom_parameter_1: getTrafficSource(),
    custom_parameter_2: 'shorthand_learning',
    send_to: 'G-DEMO123456'
  });

  // Track demo requests and interactions
  function trackDemoRequest(source) {
    gtag('event', 'demo_request', {
      event_category: 'Lead Generation',
      event_label: source,
      custom_parameter_1: getTrafficSource(),
      value: 1
    });
  }

  // Track learning module engagement
  function trackModuleStart(module_name) {
    gtag('event', 'module_start', {
      event_category: 'Learning',
      event_label: module_name,
      custom_parameter_3: module_name,
      value: 1
    });
  }

  // Track assessment completions
  function trackAssessment(module, score) {
    gtag('event', 'assessment_complete', {
      event_category: 'Achievement',
      event_label: module,
      custom_parameter_3: module,
      value: score
    });
  }

  // Track institution inquiries
  function trackInstitutionInquiry(institution_name) {
    gtag('event', 'institution_inquiry', {
      event_category: 'B2B Lead',
      event_label: institution_name,
      custom_parameter_2: 'court_reporting_school',
      value: 10 // Higher value for institutional leads
    });
  }

  // Auto-track time on page
  let startTime = Date.now();
  window.addEventListener('beforeunload', function() {
    let timeOnPage = Math.round((Date.now() - startTime) / 1000);
    gtag('event', 'timing_complete', {
      name: 'page_view_time',
      value: timeOnPage
    });
  });

  // Track scroll depth
  let maxScroll = 0;
  window.addEventListener('scroll', function() {
    let scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
    if (scrollPercent > maxScroll) {
      maxScroll = scrollPercent;
      if (scrollPercent >= 25 && scrollPercent < 50) {
        gtag('event', 'scroll', { event_category: 'Engagement', event_label: '25%' });
      } else if (scrollPercent >= 50 && scrollPercent < 75) {
        gtag('event', 'scroll', { event_category: 'Engagement', event_label: '50%' });
      } else if (scrollPercent >= 75) {
        gtag('event', 'scroll', { event_category: 'Engagement', event_label: '75%' });
      }
    }
  });
</script>

<!-- Enhanced Conversion Tracking -->
<script>
  // Track campaign conversions
  function trackCampaignConversion(campaign_type) {
    gtag('event', 'conversion', {
      event_category: 'Campaign Success',
      event_label: campaign_type,
      send_to: 'G-DEMO123456'
    });
  }

  // Track social sharing
  function trackSocialShare(platform) {
    gtag('event', 'share', {
      method: platform,
      content_type: 'education_platform',
      item_id: 'shorthand_tutor'
    });
  }
</script>
